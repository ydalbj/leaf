var $=window.jQuery;window.BxExtWidgets={init:function(){var a=this;a.hideSidebars(),a.events()},repeaterModel:function(){var a=this;return Backbone.Model.extend({initialize:function(){var b=this.get("widget"),c=b.id,d=b.number,e=b.base,f=b.elem,g=a.randomID();this.set("key",g),this.set("name","widget-"+e+"["+d+"]["+f+"]"),this.set("wid","widget-"+c+"-"+f),this.set("id",g)}})},repeaterView:function(){return Backbone.View.extend({tagName:"li",initialize:function(){var a=this.model.get("widget").object;this.displayElement(a),this.actualize(a)},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},displayElement:function(a){a.find(".bx-widget-repeatable-items").append(this.render().el)},actualize:function(a){var b=["bx-widget-repeatable-el-added"];_.each(b,function(b){this.listenTo(this,b,function(b){a.find(".bx-widget-repeatable-change").trigger("change")})},this)}})},repeaterSortable:function(a){var b=$(a),c=b.find(".bx-widget-repeatable-items");0!==c.length&&c.sortable({helper:"clone",items:"> li",cursor:"move",axis:"y",stop:function(a,b){var c=b.item.parents(".widget"),d=c.find(".widget-control-save");c.find(".bx-widget-repeatable-change").trigger("change"),"undefined"!=typeof d&&d.click()}})},randomID:function(){var a,b="abcdefghijklmnopqrstuvwxyz";randomLetter=b[Math.floor(Math.random()*b.length)],uniqidSeed=Math.floor(123456789*Math.random());var c=function(a,b){return a=parseInt(a,10).toString(16),b<a.length?a.slice(a.length-b):b>a.length?Array(1+(b-a.length)).join("0")+a:a};return uniqidSeed++,a=c(parseInt((new Date).getTime()/1e3,10),3),a+=c(uniqidSeed,2),a=randomLetter+a},hideSidebars:function(){$("body").hasClass("widgets-php")&&($("div[id*=section-]").each(function(a,b){$(b).parent(".widgets-holder-wrap").hide()}),$("#available-widgets .widget .widget-top").on("click",function(a){var b=$(".widgets-chooser > ul > li"),c=$(this).parent(".widget").find(b);c.each(function(a,b){var c=$(b);c.text().indexOf("Section")>=0&&c.remove()});var d=b;d.first().addClass("widgets-chooser-selected")}),$("#available-widgets .widget").each(function(a,b){var c=$(b);thisID=c.attr("id"),thisID.indexOf("bx-item")>=0&&c.remove()}))},tabsInit:function(a){var b=$(a),d=(b.parents(".widget").attr("id"),b.parents("div.bx-widget-tabs")),e=d.find(".bx-wt-active-link").length,f="bx-tab-not-active",g="bx-wt-active-tab",h="bx-wt-active-link",i="div.bx-wt-tab-contents",j="a.bx-wt-tab-toggle",k="div";if(d.find(j).addClass(f),d.find(i).addClass(f),b.removeClass(f),b.next(k).removeClass(f),e>=1){var l="."+f;d.find(j+l).removeClass(h),d.find(i+l).removeClass(g)}b.toggleClass(h),b.next(k).toggleClass(g)},showOnSelect:function(a){var b=$(a),c=b.parents(".widget"),d=c.find("[class*="+b.data("bx-select-class")+"]"),e=$.makeArray(d),f=b.val();$.each(e,function(a,b){b.className==f&&(d.hide(),c.find("."+f).show())})},mediaUpload:function(a,b){var c=$(a).closest("div"),d=wp.media({multiple:!1}),e=c.find(".bx-iu-image"),f=c.find(".bx-iu-image-url"),g=c.find(".bx-iu-image-remove"),h=c.find(".bx-iu-image-upload"),b="undefined"!=typeof b&&b;b===!1?d.on("select",function(a){var j,k,b=d.state().get("selection").first(),c=b.get("sizes"),i="post-thumbnail";c&&(j=c[i]||c.medium,k=c[i]||c.full),j=j||b.toJSON(),k=k||b.toJSON(),e.attr("src",j.url).css("display","block"),f.val(k.url).trigger("change"),h.css("display","none"),g.css("display","inline-block")}).open():(e.removeAttr("src").css("display","none"),f.val("").trigger("change"),g.css("display","none"),h.css("display","inline-block"))},widgetInit:function(a){var b=this,c=a.find("input.bx-is-autocomplete");b.repeaterSortable(a),a.find(".bx-widget-color-piker").wpColorPicker({change:_.throttle(function(){$("body").hasClass("wp-customizer")&&$(this).trigger("change")},200),palettes:!1}),c.autocomplete({source:bxext_widgets_customizer.icons,select:function(a,b){var c=$(this),d=c.parent().find(".bx-is-autocomplete-icon i");d.removeAttr("class").addClass("fa "+b.item.value),c.trigger("change")}})},events:function(){var a=this,b=$(document);b.on("click","a.bx-wt-tab-toggle",function(b){a.tabsInit(this),b.preventDefault()}),b.on("click",".bx-iu-image-upload",function(b){b.preventDefault(),a.mediaUpload(this)}),b.on("click",".bx-iu-image-remove",function(b){b.preventDefault(),a.mediaUpload(this,!0)}),b.on("change",".bx-select-type",function(b){b.preventDefault(),a.showOnSelect(this)}),b.on("click",".bx-widget-repeater-add",function(b){var h,i,j,c=$(this).parents(".widget"),d=a.repeaterModel(),e=a.repeaterView(),f=c.find(".id_base").val(),g=c.find(".bx-widget-repeater-el").attr("data-acb-el");j={widget:{id:c.find(".widget-id").val(),base:f,number:c.find(".widget_number").val(),object:c,elem:g},value:""},e=e.extend({className:f+"-repeatable-item bx-bs bx-clearfix",template:window.wp.template(f+"-repeater")}),h=new d(j),i=new e({model:h}),i.trigger("bx-widget-repeatable-el-added",this),b.preventDefault()}),b.on("click",".bx-widget-repeater-remove-item",function(a){var b=$(this).parents(".widget"),c=b.find(".id_base").val();$(this).parents("li."+c+"-repeatable-item").remove(),b.find(".bx-widget-repeatable-change").trigger("change"),a.preventDefault()}),b.on("widget-added",function(b,c){c.is("[id*=bx-item]")&&a.widgetInit(c),b.preventDefault()})}},$(document).ready(function(a){var b=window.BxExtWidgets;b.init()});
