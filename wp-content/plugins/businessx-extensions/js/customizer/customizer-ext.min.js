var $=window.jQuery;api=wp.customize||{},window.BxExtensions={v:{panel:"businessx_panel__sections",admin:bxext_widgets_customizer.admin_url,icons:bxext_widgets_customizer.icons,sections:bxext_widgets_customizer.sections,sections_position:bxext_widgets_customizer.sections_position,msgs:bxext_widgets_customizer.msgs,actions:$("#customize-header-actions"),mod:"businessx_sections_position"},init:function(){var e=this;e.initFirstViewModal(),e.initialSectionsPriorities(),e.initSortableSections(),e.backup()},initSortableSections:function(){var o=this,a=$(o.panelSections());a.sortable({helper:"clone",items:"> li.control-section:not(.cannot-expand)",cancel:"li.ui-sortable-handle.open",delay:150,axis:"y",update:function(e,t){var n,i=o.getPanelSections(),s=o.sectionsArray();n=_.union(s,i),o.setPrio(n),a.find(".bx_drag_and_spinner").show(),o.setSectionsPosition(n),$(".wp-full-overlay-sidebar-content").scrollTop(0)}})},initialSectionsPriorities:function(){var e=JSON.parse(api(this.v.mod).get());this.setPrio(e)},setPrio:function(e){_.each(e,function(e,t){api.section(e).priority.set(t+1)})},getPanelSections:function(){var t=api.panel(this.v.panel),n=[];return api.section.each(function(e){e.panel.get()===t.id&&n.push(e.id)}),n.shift(),n},panelHandle:function(){return api.panel(this.v.panel).container.get(0)},panelSections:function(){return api.panel(this.v.panel).contentContainer},sectionsArray:function(){var e=this.panelSections();items=$(e).sortable("toArray");for(var t=0;t<items.length;t++)items[t]=items[t].replace("accordion-section-","");return items},setSectionsPosition:function(e){var t=$(this.panelSections());e=JSON.stringify(e),api(this.v.mod).set(e),setTimeout(function(){t.find(".bx_drag_and_spinner").hide()},500)},backup:function(){var e=this.v.actions,t=this.v.msgs,n=$(document),i=e.find(".save");e.prepend('<a href="#" class="customize-controls-close bx-backup-sections"><span class="bx-backup-pulse"></span><span class="bx-backup-bubble">'+t.bk_bubble+"</span></a>"),n.on("click",".bx-backup-sections",function(e){e.preventDefault(),!0===i.is(":disabled")?$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"businessx_extensions_sections_bk",n_sections_bk:bxext_customizer_nonces.n_sections_bk}}).done(function(e){$(".bx-backup-pulse").hide(),alert(t.bk_success),n.trigger("bx-backup-success")}):alert(t.bk_fail)}),n.on("widget-added widget-updated",function(e){$(".bx-backup-pulse").show()}),n.on("click",".bx-restore-sections",function(e){e.preventDefault(),!0===i.is(":disabled")?$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"businessx_extensions_sections_rt",n_sections_rt:bxext_customizer_nonces.n_sections_rt}}).done(function(e){alert(t.bk_restore_success),location.reload(!0)}):alert(t.bk_fail)})},initFirstViewModal:function(){if(!(0<$("#businessx-frontpage-modal").length))return!1;$.magnificPopup.open({items:{src:"#businessx-frontpage-modal",type:"inline"},modal:!0,preloader:!1,focus:"#bxext-insert-frontpage"},0),$("#bxext-insert-frontpage").on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"bxext_create_frontpage",bxext_create_frontpage:bxext_customizer_nonces.bxext_create_frontpage}}).done(function(e){$.magnificPopup.close(),location.reload(!0)})}),$("#bxext-dismiss-frontpage").on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"bxext_dismiss_create_frontpage",bxext_create_frontpage:bxext_customizer_nonces.bxext_dismiss_create_frontpage}}).done(function(e){$.magnificPopup.close(),location.reload(!0)})})}},$(document).ready(function(e){window.BxExtensions.init()});